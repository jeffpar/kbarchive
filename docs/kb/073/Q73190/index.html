<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=231b77c990cb1dad78d33119176ff1f53331eb63">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Q73190: FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Q73190: FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/073/Q73190/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/073/Q73190/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","url":"http://jeffpar.github.io/kbarchive/kb/073/Q73190/","headline":"Q73190: FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="http://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q73190-fix-masm-60-align-directive-requires-patch-to-work-correctly">Q73190: FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q73190
Product(s): Microsoft Macro Assembler
Version(s): MS-DOS:6.0
Operating System(s): 
Keyword(s): 
Last Modified: 04-MAY-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Macro Assembler (MASM), version 6.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

The Microsoft Macro Assembler (MASM) version 6.0 may generate incorrect code
with respect to the ALIGN directive. If the alignment value specified is larger
than 2, the padding generated by the assembler may consist of incorrect
instructions. Instead of generating an opcode for a no-operation "mov ax, ax"
instruction (8Bh C0h), the assembler may reverse the bytes that are output (C0h
8Bh), resulting in code that fails to run correctly.

RESOLUTION
==========

This problem may be corrected by patching ML.EXE with one of the following debug
scripts. Before performing this operation on your EXE files, you might want to
make a backup copy.

  Debug Script for DOS
  --------------------

  1: a 7d8a
  2: mov ax, ax
  3:
  4: w
  5: q

  Debug Script for OS/2
  ---------------------

  1: a 325a
  2: mov ax, ax
  3:
  4: w
  5: q

To utilize one of these scripts, type the specified commands (without the line
numbers) into a file called PATCH.SCR. Note that line 3 in both scripts should
be left blank as indicated. Next, create and run a batch file that contains the
following commands:

  REN ML.EXE ML.DAT
  DEBUG ML.DAT &lt; PATCH.SCR
  REN ML.DAT ML.EXE

STATUS
======

Microsoft has confirmed this to be a problem in MASM version 6.0. This problem
was corrected in MASM version 6.0a.

MORE INFORMATION
================

The ALIGN instruction is used to indicate the boundary on which to start the
next instruction. For example, a statement such as

  ALIGN 4

indicates that the next instruction should start on a 4-byte boundary.

MASM version 6.0 may use a 2-byte instruction (that has no effect) to pad the
code. In this case, the opcode may be reversed as described above. This problem
may be illustrated by assembling the sample code below.

Sample Code
-----------

  ; Assemble options needed: none

  .MODEL large
  .STACK 4096

  .DATA
  _data ENDS

  _CodeSeg SEGMENT para public 'code'
  main PROC
     mov ax, dx
     ALIGN 8
     mov ax, 0
  main ENDP
  _CodeSeg ENDS
  END main

Additional query words: 6.00 buglist6.00 fixlist6.00a

======================================================================
Keywords          :  
Technology        : kbMASMsearch kbAudDeveloper kbMASM600
Version           : MS-DOS:6.0
Solution Type     : kbfix

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


</body>
</html>