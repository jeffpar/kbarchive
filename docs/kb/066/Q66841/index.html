<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=231b77c990cb1dad78d33119176ff1f53331eb63">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Q66841: Does /ND Override /Aw? | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Q66841: Does /ND Override /Aw?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/066/Q66841/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/066/Q66841/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","url":"http://jeffpar.github.io/kbarchive/kb/066/Q66841/","headline":"Q66841: Does /ND Override /Aw?","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="http://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q66841-does-nd-override-aw">Q66841: Does /ND Override /Aw?</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q66841
Product(s): See article
Version(s): 6.00   | 6.00
Operating System(s): MS-DOS | OS/2
Keyword(s): ENDUSER | | mspl13_c
Last Modified: 18-NOV-1990

Question:

I have two separate modules to an application that I compile with
/Alfw and /ND. The documentation states that /Aw will assume SS!=DS
and DS is not loaded. However, when I examine the assembler output
(/Fc or /Fa), I see that DS is loaded for each function in the modules
compiled with /ND. Is this a problem in the compiler? Does /ND
override /Aw?

Response:

You are confusing the functionality of these two switches. The /Aw
switch is used by the compiler to determine if local variables
(typically stack based) can be based on DS, as well as SS. Take the
case where a variable needs to be copied from local data to global
data, which would normally include a couple of MOV instructions. If
the compiler can assume DS=SS, it can generate a LEA instruction on
the stack-based variable and set up ES:DI with the destination. DS
will already be set to the correct value. If DS != SS, the compiler
will have to generate more code to correctly access the stack-based
variable.

Now, for the /ND switch. In this case, the data segment for the module
is not the default segment. The compiler will do an explicit DS load
at function entry point because of just this fact, that is, there is
no way for the compiler to know that DS is properly set to the
nonstandard segment name (not DGROUP). While this behavior is indeed
the same behavior as the _loadds keyword, it has nothing to do with
the main reason for /Aw (DS!=SS).

To summarize, the /Aw switch doesn't cause the segment load, but it
also doesn't stop it. This is one case where one switch (/ND) can
override one of the effects of another switch (/Aw). However, the main
effect of the /Aw switch is not changed (don't assume DS = SS).
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


</body>
</html>