<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=231b77c990cb1dad78d33119176ff1f53331eb63">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Q69476: stdout/stderr Are Buffered When Stack Is Moved Out of DGROUP | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Q69476: stdout/stderr Are Buffered When Stack Is Moved Out of DGROUP" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/069/Q69476/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/069/Q69476/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","url":"http://jeffpar.github.io/kbarchive/kb/069/Q69476/","headline":"Q69476: stdout/stderr Are Buffered When Stack Is Moved Out of DGROUP","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="http://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q69476-stdoutstderr-are-buffered-when-stack-is-moved-out-of-dgroup">Q69476: stdout/stderr Are Buffered When Stack Is Moved Out of DGROUP</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q69476
Product(s): See article
Version(s): 6.00 6.00a
Operating System(s): MS-DOS
Keyword(s): ENDUSER | buglist6.00 buglist6.00a | mspl13_c
Last Modified: 25-FEB-1991

By following the instructions in the C 6.00 STARTUP.DOC file, you can
recompile/reassemble the C start-up code and modify existing libraries
so that the stack will be moved out of DGROUP for programs linked with
these modified libraries. When using the DOS version of these modified
libraries, stdout and stderr are unexpectedly buffered. The sample
code and sample output below illustrate this problem.

The OS/2 versions of the modified libraries perform as expected;
however, to achieve the correct behavior with the DOS versions of the
modified libraries, you must add the following line to your code:

   setvbuf(stdout, NULL, _IONBF, 0);

This line sets buffering for streams to none.

Information about the predefined stream pointers can be observed by
compiling the start-up code with CodeView information and placing a
watch on the _iob2 array. Information about stdout is in _iob2[1].
After executing the start-up code, the buffer size on stdout is still
0 (zero); however, once a function call is made to printf(), the
buffer size for _iob2[1] is changed to 512 (0x200) bytes. This change
does not occur when the stack is left in DGROUP.

Microsoft has confirmed this to be a problem in C versions 6.00 and
6.00a. We are researching this problem and will post new information
here as it becomes available.

Sample Code
-----------

/* Compile options needed: /c /ALw /Zi /Od
      Link options needed: /CO /NOD (plus you must specify the
                           modified DOS C run-time library)
*/

#include &lt;stdio.h&gt;

int number;

void main(void)
{
    /* Uncomment the following line to obtain the desired results */
    /* setvbuf(stdout, NULL, _IONBF, 0); */

    printf("\nEnter a number: ");
    scanf("%d", &amp;number);
    printf("\nThe number is %1d\n", number);
}

Program Output
--------------

22                   /* user enters a number (without prompt) */

Enter a number:      /* printf() output is buffered, so output does */
The number is 22     /* not appear until exit code flushes buffers  */
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


</body>
</html>