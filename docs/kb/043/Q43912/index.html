<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=231b77c990cb1dad78d33119176ff1f53331eb63">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Q43912: C: /Oa Causes Changes in Variable Values to Be Ignored | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Q43912: C: /Oa Causes Changes in Variable Values to Be Ignored" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/043/Q43912/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/043/Q43912/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","url":"http://jeffpar.github.io/kbarchive/kb/043/Q43912/","headline":"Q43912: C: /Oa Causes Changes in Variable Values to Be Ignored","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="http://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q43912-c-oa-causes-changes-in-variable-values-to-be-ignored">Q43912: C: /Oa Causes Changes in Variable Values to Be Ignored</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q43912
Product(s): See article
Version(s): 5.10   | 5.10
Operating System(s): MS-DOS | OS/2
Keyword(s): ENDUSER | SR# G890421-16911 alias buglist5.10 | mspl13_c
Last Modified: 1-JUN-1989

The code generated by the following program is incorrect when
compiled with /Oa (with or without other optimizations). Two workarounds
are to compile without /Oa or to use a temporary variable.

A program that demonstrates the error and an assembly listing of the
code follows:

Source:

static int index;
static int len;
static char *strbuf;

void main()
{
    if (index &gt;= len)
    {
        strbuf[len++] = ' ';      /* works correctly */
        strbuf[len] = '\0';       /* null is put in the wrong place! */
    }
}

Assembly listing:

_main:
7:      {
5C83:0000 56             PUSH      SI
8:          if (index &gt;= len)
5C83:0001 A1DE01         MOV       AX,Word Ptr [len (01DE)]
5C83:0004 3906DA01       CMP       Word Ptr [index (01DA)],AX
5C83:0008 7C13           JL        _main+1d (001D)
10:            strbuf[len++] = ' ';               /* works correctly */
5C83:000A BEDE01         MOV       SI,len (01DE)
5C83:000D 8B1C           MOV       BX,Word Ptr [SI]
5C83:000F FF04           INC       Word Ptr [SI]
5C83:0011 8B36DC01       MOV       SI,Word Ptr [strbuf (01DC)]
5C83:0015 C60020         MOV       Byte Ptr [BX+SI],20
11:            strbuf[len] = '\0';    /* null is put in the wrong place */
5C83:0018 8BD8           MOV       BX,AX
5C83:001A C60000         MOV       Byte Ptr [BX+SI],00
13:     }
5C83:001D 5E             POP       SI

The "MOV BX, AX" generated for "strbuf[len] = '\0';" above should be a
"MOV BX, [len]". AX contains the old value of len at this point, not
the incremented value.
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


</body>
</html>